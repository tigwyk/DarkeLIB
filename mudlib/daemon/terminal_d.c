//      /obj/daemon/terminal_d.c
//      from the Nightmare Mudlib
//      Contains all the terminal information used to initialize
//      a player's terminal settings
//      created by Pinkfish@Discworld
//      rewritten for the Nightmare Mudlib by Descartes of Borg 930903

#define ANSI(p) sprintf("%c["+(p)+"m", 27)
#define ESC(p) sprintf("%c"+(p), 27)

string* ALL_KEYS = ({ "RESET", "BOLD", "FLASH", "RED", "BLUE", "CYAN",
      "MAGENTA", "ORANGE", "YELLOW", "GREEN", "WHITE", "BLACK", "B_RED",
      "B_ORANGE", "B_YELLOW", "B_BLACK", "B_CYAN", "B_WHITE", "B_GREEN",
      "B_BLUE", "B_MAGENTA", "STATUS", "WINDOW", "INITTERM", "ENDTERM",
      "BROWN", "B_BROWN", "UNDERLINE" });

mapping term_info;

void create() {
   mixed key, val;
   /* This is super disgusting, but it's nicer than an algorithmic version due
    * to how the eye percieves colour */
   string* lookup = ({
         /* 0   */ ANSI(30),
         /* 1   */ ANSI(31),
         /* 2   */ ANSI(32),
         /* 3   */ ANSI(33),
         /* 4   */ ANSI(34),
         /* 5   */ ANSI(35),
         /* 6   */ ANSI(36),
         /* 7   */ ANSI(37),
         /* 8   */ ANSI(1)+ANSI(30),
         /* 9   */ ANSI(1)+ANSI(31),
         /* 10  */ ANSI(1)+ANSI(32),
         /* 11  */ ANSI(1)+ANSI(33),
         /* 12  */ ANSI(1)+ANSI(34),
         /* 13  */ ANSI(1)+ANSI(35),
         /* 14  */ ANSI(1)+ANSI(36),
         /* 15  */ ANSI(1)+ANSI(37),
         /* 16  */ ANSI(30),
         /* 17  */ ANSI(34),
         /* 18  */ ANSI(34),
         /* 19  */ ANSI(34),
         /* 20  */ ANSI(1)+ANSI(34),
         /* 21  */ ANSI(1)+ANSI(34),
         /* 22  */ ANSI(32),
         /* 23  */ ANSI(36),
         /* 24  */ ANSI(36),
         /* 25  */ ANSI(34),
         /* 26  */ ANSI(1)+ANSI(34),
         /* 27  */ ANSI(1)+ANSI(34),
         /* 28  */ ANSI(32),
         /* 29  */ ANSI(36),
         /* 30  */ ANSI(36),
         /* 31  */ ANSI(36),
         /* 32  */ ANSI(1)+ANSI(34),
         /* 33  */ ANSI(1)+ANSI(34),
         /* 34  */ ANSI(32),
         /* 35  */ ANSI(32),
         /* 36  */ ANSI(36),
         /* 37  */ ANSI(36),
         /* 38  */ ANSI(36),
         /* 39  */ ANSI(1)+ANSI(36),
         /* 40  */ ANSI(1)+ANSI(32),
         /* 41  */ ANSI(1)+ANSI(32),
         /* 42  */ ANSI(1)+ANSI(32),
         /* 43  */ ANSI(36),
         /* 44  */ ANSI(1)+ANSI(36),
         /* 45  */ ANSI(1)+ANSI(36),
         /* 46  */ ANSI(1)+ANSI(32),
         /* 47  */ ANSI(1)+ANSI(32),
         /* 48  */ ANSI(1)+ANSI(32),
         /* 49  */ ANSI(1)+ANSI(36),
         /* 50  */ ANSI(1)+ANSI(36),
         /* 51  */ ANSI(1)+ANSI(36),
         /* 52  */ ANSI(31),
         /* 53  */ ANSI(35),
         /* 54  */ ANSI(35),
         /* 55  */ ANSI(34),
         /* 56  */ ANSI(1)+ANSI(34),
         /* 57  */ ANSI(1)+ANSI(34),
         /* 58  */ ANSI(33),
         /* 59  */ ANSI(1)+ANSI(30),
         /* 60  */ ANSI(34),
         /* 61  */ ANSI(34),
         /* 62  */ ANSI(1)+ANSI(34),
         /* 63  */ ANSI(1)+ANSI(34),
         /* 64  */ ANSI(33),
         /* 65  */ ANSI(32),
         /* 66  */ ANSI(36),
         /* 67  */ ANSI(36),
         /* 68  */ ANSI(1)+ANSI(34),
         /* 69  */ ANSI(1)+ANSI(34),
         /* 70  */ ANSI(32),
         /* 71  */ ANSI(32),
         /* 72  */ ANSI(36),
         /* 73  */ ANSI(36),
         /* 74  */ ANSI(36),
         /* 75  */ ANSI(1)+ANSI(36),
         /* 76  */ ANSI(1)+ANSI(32),
         /* 77  */ ANSI(1)+ANSI(32),
         /* 78  */ ANSI(1)+ANSI(32),
         /* 79  */ ANSI(36),
         /* 80  */ ANSI(1)+ANSI(36),
         /* 81  */ ANSI(1)+ANSI(36),
         /* 82  */ ANSI(1)+ANSI(32),
         /* 83  */ ANSI(1)+ANSI(32),
         /* 84  */ ANSI(1)+ANSI(32),
         /* 85  */ ANSI(1)+ANSI(36),
         /* 86  */ ANSI(1)+ANSI(36),
         /* 87  */ ANSI(1)+ANSI(36),
         /* 88  */ ANSI(31),
         /* 89  */ ANSI(35),
         /* 90  */ ANSI(35),
         /* 91  */ ANSI(35),
         /* 92  */ ANSI(1)+ANSI(34),
         /* 93  */ ANSI(1)+ANSI(34),
         /* 94  */ ANSI(33),
         /* 95  */ ANSI(31),
         /* 96  */ ANSI(35),
         /* 97  */ ANSI(35),
         /* 98  */ ANSI(1)+ANSI(34),
         /* 99  */ ANSI(1)+ANSI(34),
         /* 100 */ ANSI(33),
         /* 101 */ ANSI(33),
         /* 102 */ ANSI(37),
         /* 103 */ ANSI(34),
         /* 104 */ ANSI(1)+ANSI(34),
         /* 105 */ ANSI(1)+ANSI(34),
         /* 106 */ ANSI(33),
         /* 107 */ ANSI(33),
         /* 108 */ ANSI(32),
         /* 109 */ ANSI(36),
         /* 110 */ ANSI(36),
         /* 111 */ ANSI(1)+ANSI(34),
         /* 112 */ ANSI(1)+ANSI(32),
         /* 113 */ ANSI(1)+ANSI(32),
         /* 114 */ ANSI(1)+ANSI(32),
         /* 115 */ ANSI(36),
         /* 116 */ ANSI(1)+ANSI(36),
         /* 117 */ ANSI(1)+ANSI(36),
         /* 118 */ ANSI(1)+ANSI(32),
         /* 119 */ ANSI(1)+ANSI(32),
         /* 120 */ ANSI(1)+ANSI(32),
         /* 121 */ ANSI(1)+ANSI(32),
         /* 122 */ ANSI(1)+ANSI(36),
         /* 123 */ ANSI(1)+ANSI(36),
         /* 124 */ ANSI(31),
         /* 125 */ ANSI(31),
         /* 126 */ ANSI(35),
         /* 127 */ ANSI(35),
         /* 128 */ ANSI(35),
         /* 129 */ ANSI(1)+ANSI(35),
         /* 130 */ ANSI(31),
         /* 131 */ ANSI(31),
         /* 132 */ ANSI(35),
         /* 133 */ ANSI(35),
         /* 134 */ ANSI(35),
         /* 135 */ ANSI(1)+ANSI(35),
         /* 136 */ ANSI(33),
         /* 137 */ ANSI(33),
         /* 138 */ ANSI(31),
         /* 139 */ ANSI(35),
         /* 140 */ ANSI(35),
         /* 141 */ ANSI(1)+ANSI(34),
         /* 142 */ ANSI(33),
         /* 143 */ ANSI(33),
         /* 144 */ ANSI(33),
         /* 145 */ ANSI(37),
         /* 146 */ ANSI(1)+ANSI(34),
         /* 147 */ ANSI(1)+ANSI(34),
         /* 148 */ ANSI(33),
         /* 149 */ ANSI(33),
         /* 150 */ ANSI(33),
         /* 151 */ ANSI(1)+ANSI(32),
         /* 152 */ ANSI(1)+ANSI(36),
         /* 153 */ ANSI(1)+ANSI(36),
         /* 154 */ ANSI(1)+ANSI(33),
         /* 155 */ ANSI(1)+ANSI(33),
         /* 156 */ ANSI(1)+ANSI(32),
         /* 157 */ ANSI(1)+ANSI(32),
         /* 158 */ ANSI(1)+ANSI(36),
         /* 159 */ ANSI(1)+ANSI(36),
         /* 160 */ ANSI(1)+ANSI(31),
         /* 161 */ ANSI(1)+ANSI(31),
         /* 162 */ ANSI(1)+ANSI(31),
         /* 163 */ ANSI(35),
         /* 164 */ ANSI(1)+ANSI(35),
         /* 165 */ ANSI(1)+ANSI(35),
         /* 166 */ ANSI(1)+ANSI(31),
         /* 167 */ ANSI(1)+ANSI(31),
         /* 168 */ ANSI(1)+ANSI(31),
         /* 169 */ ANSI(35),
         /* 170 */ ANSI(1)+ANSI(35),
         /* 171 */ ANSI(1)+ANSI(35),
         /* 172 */ ANSI(1)+ANSI(31),
         /* 173 */ ANSI(1)+ANSI(31),
         /* 174 */ ANSI(1)+ANSI(31),
         /* 175 */ ANSI(35),
         /* 176 */ ANSI(1)+ANSI(35),
         /* 177 */ ANSI(1)+ANSI(35),
         /* 178 */ ANSI(33),
         /* 179 */ ANSI(33),
         /* 180 */ ANSI(33),
         /* 181 */ ANSI(1)+ANSI(31),
         /* 182 */ ANSI(1)+ANSI(35),
         /* 183 */ ANSI(1)+ANSI(35),
         /* 184 */ ANSI(1)+ANSI(33),
         /* 185 */ ANSI(1)+ANSI(33),
         /* 186 */ ANSI(1)+ANSI(33),
         /* 187 */ ANSI(1)+ANSI(33),
         /* 188 */ ANSI(1)+ANSI(37),
         /* 189 */ ANSI(1)+ANSI(37),
         /* 190 */ ANSI(1)+ANSI(33),
         /* 191 */ ANSI(1)+ANSI(33),
         /* 192 */ ANSI(1)+ANSI(33),
         /* 193 */ ANSI(1)+ANSI(33),
         /* 194 */ ANSI(1)+ANSI(37),
         /* 195 */ ANSI(1)+ANSI(37),
         /* 196 */ ANSI(1)+ANSI(31),
         /* 197 */ ANSI(1)+ANSI(31),
         /* 198 */ ANSI(1)+ANSI(31),
         /* 199 */ ANSI(1)+ANSI(35),
         /* 200 */ ANSI(1)+ANSI(35),
         /* 201 */ ANSI(1)+ANSI(35),
         /* 202 */ ANSI(1)+ANSI(31),
         /* 203 */ ANSI(1)+ANSI(31),
         /* 204 */ ANSI(1)+ANSI(31),
         /* 205 */ ANSI(1)+ANSI(35),
         /* 206 */ ANSI(1)+ANSI(35),
         /* 207 */ ANSI(1)+ANSI(35),
         /* 208 */ ANSI(1)+ANSI(31),
         /* 209 */ ANSI(1)+ANSI(31),
         /* 210 */ ANSI(1)+ANSI(31),
         /* 211 */ ANSI(1)+ANSI(31),
         /* 212 */ ANSI(1)+ANSI(35),
         /* 213 */ ANSI(1)+ANSI(35),
         /* 214 */ ANSI(1)+ANSI(33),
         /* 215 */ ANSI(1)+ANSI(33),
         /* 216 */ ANSI(1)+ANSI(31),
         /* 217 */ ANSI(1)+ANSI(31),
         /* 218 */ ANSI(1)+ANSI(35),
         /* 219 */ ANSI(1)+ANSI(35),
         /* 220 */ ANSI(1)+ANSI(33),
         /* 221 */ ANSI(1)+ANSI(33),
         /* 222 */ ANSI(1)+ANSI(33),
         /* 223 */ ANSI(1)+ANSI(33),
         /* 224 */ ANSI(1)+ANSI(37),
         /* 225 */ ANSI(1)+ANSI(37),
         /* 226 */ ANSI(1)+ANSI(33),
         /* 227 */ ANSI(1)+ANSI(33),
         /* 228 */ ANSI(1)+ANSI(33),
         /* 229 */ ANSI(1)+ANSI(33),
         /* 230 */ ANSI(1)+ANSI(37),
         /* 231 */ ANSI(1)+ANSI(37),
         /* 232 */ ANSI(1)+ANSI(30),
         /* 233 */ ANSI(1)+ANSI(30),
         /* 234 */ ANSI(1)+ANSI(30),
         /* 235 */ ANSI(1)+ANSI(30),
         /* 236 */ ANSI(1)+ANSI(30),
         /* 237 */ ANSI(1)+ANSI(30),
         /* 238 */ ANSI(1)+ANSI(30),
         /* 239 */ ANSI(1)+ANSI(30),
         /* 240 */ ANSI(1)+ANSI(30),
         /* 241 */ ANSI(1)+ANSI(30),
         /* 242 */ ANSI(1)+ANSI(30),
         /* 243 */ ANSI(1)+ANSI(30),
         /* 244 */ ANSI(37),
         /* 245 */ ANSI(37),
         /* 246 */ ANSI(37),
         /* 247 */ ANSI(37),
         /* 248 */ ANSI(37),
         /* 249 */ ANSI(37),
         /* 250 */ ANSI(1)+ANSI(37),
         /* 251 */ ANSI(1)+ANSI(37),
         /* 252 */ ANSI(1)+ANSI(37),
         /* 253 */ ANSI(1)+ANSI(37),
         /* 254 */ ANSI(1)+ANSI(37),
         /* 255 */ ANSI(1)+ANSI(37)
   });

   /* Create the indices list */
   for(int i = 0; i < 256; i++)
      ALL_KEYS += ({ "COLOR"+i });

    term_info = ([
"unknown": ([ ]), /* filled in later */
"ansi": ([
   "RESET":ANSI("0;37;40"),
   "BOLD":ANSI(1),
   "FLASH":"",
   "BLACK":ANSI(30),
   "RED":ANSI(31),
   "GREEN":ANSI(32),
   "ORANGE":ANSI(33),
   "YELLOW":ANSI(1)+ANSI(33),
   "BLUE": ANSI(34),
   "CYAN":ANSI(36),
   "MAGENTA":ANSI(35),
   "BLACK":ANSI(30),
   "WHITE": ANSI(37),
   "B_RED":ANSI(41),
   "B_GREEN":ANSI(42),
   "B_ORANGE":ANSI(43),
   "B_YELLOW":ANSI(1)+ANSI(43),
   "B_BLUE":ANSI(44),
   "B_CYAN":ANSI(46),
   "B_BLACK":ANSI(40),
   "B_WHITE": ANSI(47),
   "B_MAGENTA":ANSI(45),
   "STATUS":"",
   "WINDOW":"",
   "INITTERM":"",
   "ENDTERM":"",
   "BROWN":ANSI(33),
   "B_BROWN":ANSI(43),
   "UNDERLINE":ANSI(4)
   ]),
"xterm-256": ([
   "RESET": ANSI(0),
   "BOLD": ANSI(1),
   "FLASH":"",
   "BLACK":ANSI(30),
   "RED":ANSI(31),
   "GREEN":ANSI(32),
   "ORANGE":ANSI("38;5;208"),
   "YELLOW":ANSI(1)+ANSI(33),
   "BLUE":ANSI(34),
   "CYAN":ANSI(36),
   "MAGENTA":ANSI(35),
   "BLACK":ANSI(30),
   "WHITE":ANSI(37),
   "B_RED":ANSI(41),
   "B_GREEN":ANSI(42),
   "B_ORANGE":ANSI("48;5;208"),
   "B_YELLOW":ANSI(43),
   "B_BLUE":ANSI(44),
   "B_CYAN":ANSI(46),
   "B_BLACK":ANSI(40),
   "B_WHITE":ANSI(47),
   "B_MAGENTA":ANSI(45),
   "STATUS":"",
   "WINDOW":"",
   "INITTERM":"",
   "ENDTERM":"",
   "BROWN": ANSI("38;5;94"),
   "B_BROWN": ANSI("48;5;94"),
   "UNDERLINE": ANSI(4),
   ]),
]);
    /* Fill in xterm-256 colours & ansi fallbacks */
    for(int i = 0; i < 256; i++)
    {
       term_info["xterm-256"]["COLOR"+i] = ANSI(("38;5;"+i));
       term_info["ansi"]["COLOR"+i] = lookup[i];
    }
    /* Fill in any blank entries */
    foreach(key, val in term_info)
    {
       mixed id;
       mixed keys = keys(val);
       keys = ALL_KEYS - keys;
       foreach(id in keys)
          term_info[key][id] = "";
    }
}

mapping query_term_info(string type) {
    return (term_info[type] ? term_info[type] : term_info["unknown"]);
}

string *query_terms() { return keys(term_info); }

int query_term_support(string str) {
    return (term_info[str] ? 1 : 0);
}
